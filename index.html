<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather</title>
  <style>
    :root{
      --bg: #0b1220;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.52);
      --good: #38d39f;
      --warn: #ffcc66;
      --bad: #ff6b6b;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 18px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 900px at 15% 10%, rgba(68,142,255,.22), transparent 55%),
        radial-gradient(900px 700px at 85% 20%, rgba(56,211,159,.18), transparent 55%),
        radial-gradient(1000px 700px at 40% 90%, rgba(255,107,107,.14), transparent 55%),
        var(--bg);
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 16px 56px;
    }

    header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 240px;
    }

    .logo{
      width: 40px; height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(68,142,255,.9), rgba(56,211,159,.85));
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
      position: relative;
      overflow: hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 45%);
      transform: rotate(20deg);
    }

    h1{
      font-size: 18px;
      margin: 0;
      letter-spacing: .2px;
    }
    .sub{
      margin: 2px 0 0;
      font-size: 13px;
      color: var(--muted);
    }

    .actions{
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .btn{
      appearance: none;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform .08s ease, background .18s ease, border-color .18s ease;
      user-select: none;
    }
    .btn:hover{ background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(68,142,255,.95), rgba(56,211,159,.92));
      border-color: transparent;
      color: rgba(10,14,22,.96);
    }
    .btn.primary:hover{ filter: brightness(1.05); }
    .btn.ghost{
      background: transparent;
    }
    .btn:disabled{
      opacity: .55;
      cursor: not-allowed;
    }

    .grid{
      display: grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      margin-top: 14px;
    }

    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
      header{ flex-direction: column; align-items: stretch; }
      .actions{ justify-content: stretch; }
      .btn{ flex: 1; justify-content: center; }
    }

    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card .hd{
      padding: 14px 14px 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .title{
      margin: 0;
      font-size: 13px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .3px;
      text-transform: uppercase;
    }

    .pill{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      white-space: nowrap;
    }

    .body{
      padding: 14px;
    }

    .searchRow{
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .input{
      flex: 1;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 12px;
      padding: 11px 12px;
      font-size: 14px;
      outline: none;
    }
    .input::placeholder{ color: rgba(255,255,255,.45); }
    .input:focus{ border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.09); }

    .big{
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 10px;
      padding: 18px 14px 4px;
    }

    .place{
      font-size: 18px;
      font-weight: 800;
      letter-spacing: .2px;
      margin: 0;
    }
    .desc{
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 14px;
      text-transform: capitalize;
    }

    .temp{
      font-size: 48px;
      font-weight: 900;
      letter-spacing: -1px;
      line-height: 1;
    }
    .unit{
      font-size: 16px;
      font-weight: 800;
      color: var(--muted);
      margin-left: 6px;
    }

    .meta{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 10px 14px 14px;
    }

    .stat{
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .stat .k{
      font-size: 12px;
      color: var(--muted2);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .3px;
    }
    .stat .v{
      margin-top: 6px;
      font-size: 14px;
      font-weight: 800;
    }

    .state{
      padding: 12px 14px;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      color: var(--muted);
      font-size: 13px;
      min-height: 44px;
    }

    .dot{
      width: 10px; height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,.22);
      box-shadow: 0 0 0 4px rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .dot.good{ background: var(--good); box-shadow: 0 0 0 4px rgba(56,211,159,.15); }
    .dot.warn{ background: var(--warn); box-shadow: 0 0 0 4px rgba(255,204,102,.15); }
    .dot.bad{ background: var(--bad); box-shadow: 0 0 0 4px rgba(255,107,107,.15); }

    details{
      border-top: 1px solid var(--border);
      padding: 8px 14px 14px;
    }
    summary{
      cursor: pointer;
      list-style: none;
      color: var(--muted);
      font-weight: 700;
      font-size: 13px;
      outline: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 0;
    }
    summary::-webkit-details-marker{ display:none; }

    pre{
      margin: 0;
      padding: 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
      overflow: auto;
      color: rgba(255,255,255,.86);
      font-size: 12px;
      line-height: 1.45;
    }

    .footerHint{
      margin-top: 14px;
      color: var(--muted2);
      font-size: 12px;
      text-align: center;
    }

    .icon{ width: 16px; height: 16px; display:inline-block; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Weather</h1>
          <div class="sub">Fast, clean, and actually usable.</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn ghost" id="geoBtn" title="Use your current location">
          <span class="icon">üìç</span>
          Use my location
        </button>
        <button class="btn primary" id="refreshBtn" title="Refresh the current view">
          <span class="icon">‚Üª</span>
          Refresh
        </button>
      </div>
    </header>

    <div class="grid">
      <!-- Main weather card -->
      <section class="card" aria-label="Current weather">
        <div class="hd">
          <div>
            <div class="title">Current weather</div>
          </div>
          <div class="pill" id="sourcePill">‚Äî</div>
        </div>

        <div class="big">
          <div>
            <p class="place" id="place">Search a city or use your location</p>
            <p class="desc" id="desc">‚Äî</p>
          </div>
          <div>
            <span class="temp" id="temp">‚Äî</span><span class="unit">¬∞C</span>
          </div>
        </div>

        <div class="meta">
          <div class="stat">
            <div class="k">Humidity</div>
            <div class="v" id="hum">‚Äî</div>
          </div>
          <div class="stat">
            <div class="k">Wind</div>
            <div class="v" id="wind">‚Äî</div>
          </div>
          <div class="stat">
            <div class="k">Feels like</div>
            <div class="v" id="feels">‚Äî</div>
          </div>
        </div>

        <div class="state">
          <div style="display:flex; align-items:center; gap:10px;">
            <span class="dot" id="dot"></span>
            <span id="status">Idle</span>
          </div>
          <span id="time" style="color:var(--muted2);"></span>
        </div>

        <details>
          <summary>Developer details</summary>
          <pre id="raw">{}</pre>
        </details>
      </section>
      <section class="card">
  <div class="hd">
    <div class="title">5-day forecast</div>
  </div>
  <div class="body">
    <div id="forecast"></div>
  </div>
</section>

      <!-- Search / tips card -->
      <aside class="card" aria-label="Search">
        <div class="hd">
          <div class="title">Search</div>
          <div class="pill">Backend: 5001</div>
        </div>
        <div class="body">
          <div style="color:var(--muted); font-size:13px; line-height:1.5;">
            Type a city. Hit Enter. Or use your location.
          </div>

          <div class="searchRow">
            <input class="input" id="city" placeholder="e.g., London, Paris, Lagos" autocomplete="off" />
            <button class="btn" id="cityBtn"><span class="icon">üîé</span>Search</button>
          </div>

          <div style="margin-top: 12px; color: var(--muted2); font-size: 12px; line-height: 1.6;">
            Common issues:
            <ul style="margin:8px 0 0 18px; padding:0;">
              <li>If you deny location permission, geolocation won‚Äôt work.</li>
              <li>If you see ‚ÄúFailed to fetch‚Äù, your backend probably isn‚Äôt running.</li>
              <li>Use <code style="color:rgba(255,255,255,.75)">http://127.0.0.1:5173</code>, not <code style="color:rgba(255,255,255,.75)">file://</code>.</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>

    <div class="footerHint">
      Tip: keep the backend running in one terminal and the frontend server in another.
    </div>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:5001";

    const el = (id) => document.getElementById(id);
    const place = el("place");
    const desc = el("desc");
    const temp = el("temp");
    const hum  = el("hum");
    const wind = el("wind");
    const feels= el("feels");
    const status = el("status");
    const dot = el("dot");
    const raw = el("raw");
    const timeEl = el("time");
    const sourcePill = el("sourcePill");
    const cityInput = el("city");

    const geoBtn = el("geoBtn");
    const cityBtn = el("cityBtn");
    const refreshBtn = el("refreshBtn");

    let lastMode = null; // { type: "city", city } OR { type: "coords", lat, lon }

    function nowTime(){
      const d = new Date();
      return d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
    }

    function setState(kind, msg){
      status.textContent = msg;
      dot.className = "dot" + (kind ? " " + kind : "");
      timeEl.textContent = nowTime();
    }

    function setWeatherCard(data, sourceLabel){
      const c = data.city ? `${data.city}${data.country ? ", " + data.country : ""}` : "‚Äî";
      place.textContent = c;
      desc.textContent = (data.weather || data.description || "‚Äî");
      temp.textContent = (data.temperature ?? data.temp_c ?? "‚Äî");
      hum.textContent  = ((data.humidity ?? "‚Äî") + (data.humidity != null ? "%" : ""));
      wind.textContent = ((data.wind ?? data.wind_mps ?? "‚Äî") + (data.wind != null || data.wind_mps != null ? " m/s" : ""));
      feels.textContent= ((data.feels_like ?? data.feels_like_c ?? "‚Äî") + (data.feels_like != null || data.feels_like_c != null ? " ¬∞C" : ""));
      raw.textContent  = JSON.stringify(data, null, 2);
      sourcePill.textContent = sourceLabel;
    }

    async function fetchJson(url){
      const r = await fetch(url);
      const text = await r.text();
      let data = {};
      try { data = text ? JSON.parse(text) : {}; } catch { data = { raw: text }; }
      if (!r.ok) throw data;
      return data;
    }

    async function byCity(city){
      const c = (city || "").trim();
      if (!c) return;

      lastMode = { type: "city", city: c };
      setState("warn", "Loading‚Ä¶");
      sourcePill.textContent = "City";
      try{
        const data = await fetchJson(`${API_BASE}/weather?city=${encodeURIComponent(c)}`);
        setWeatherCard(data, "City");
        setState("good", "Updated");
      } catch(err){
        raw.textContent = JSON.stringify(err, null, 2);
        setWeatherCard({ city: "‚Äî", weather: "‚Äî", temperature: "‚Äî", humidity: null }, "City");
        setState("bad", (err.error || err.message || "Request failed"));
      }
    }

    function byLocation(){
      setState("warn", "Requesting location‚Ä¶");
      sourcePill.textContent = "Location";

      if (!navigator.geolocation){
        setState("bad", "Geolocation not supported");
        return;
      }

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        lastMode = { type: "coords", lat, lon };

        setState("warn", "Loading‚Ä¶");
        try{
          const data = await fetchJson(`${API_BASE}/weather/coords?lat=${lat}&lon=${lon}`);
          setWeatherCard(data, "Location");
          setState("good", "Updated");
        } catch(err){
          raw.textContent = JSON.stringify(err, null, 2);
          setWeatherCard({ city: "‚Äî", weather: "‚Äî", temperature: "‚Äî", humidity: null }, "Location");
          setState("bad", (err.error || err.message || "Request failed"));
        }
      }, (err) => {
        setState("bad", `Location error: ${err.message}`);
      }, { enableHighAccuracy: true, timeout: 10000 });
    }

    async function refresh(){
      if (!lastMode){
        setState("", "Nothing to refresh yet");
        return;
      }
      if (lastMode.type === "city") return byCity(lastMode.city);
      if (lastMode.type === "coords") return byLocation();
    }

    geoBtn.addEventListener("click", byLocation);
    cityBtn.addEventListener("click", () => byCity(cityInput.value));
    refreshBtn.addEventListener("click", refresh);
    cityInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") byCity(cityInput.value);
    });

    // Optional: start with a sensible default so it doesn't look empty.
    // You can remove this line if you want a blank start.
    byCity("London");
  </script>
  <script defer src="./js/app.js"></script>
</body>
</html>